class e{constructor(e,t,r){this.startTime=Date.now(),this.ROWS=e,this.COLUMNS=t,this.board=[],this.mines=r,this.mineLocations=new Set}init(){for(;this.mineLocations.size!==this.mines;)this.mineLocations.add(Math.floor(Math.random()*this.ROWS*this.COLUMNS));for(let e=0;e<this.ROWS;e++){const t=[];for(let r=0;r<this.COLUMNS;r++)t.push({x:e,y:r,isMine:this.mineLocations.has(this.ROWS*e+r),isRevealed:!1,value:null});this.board.push(t)}for(let e=0;e<this.ROWS;e++)for(let t=0;t<this.COLUMNS;t++)this.board[e][t].isMine||(this.board[e][t].value=this.getValueAtCell(e,t))}printBoard(){for(let e=0;e<this.ROWS;e++){let t="";for(let r=0;r<this.COLUMNS;r++)t+=` ${this.board[e][r].isMine?"‚óâ":this.board[e][r].value} `;console.log(`${t}\n`)}}getValueAtCell(e,t){let r=0;for(let n=-1;n<2;n++){const s=this.board[e+n];s&&(s[t-1]&&s[t-1].isMine&&(r+=1),s[t]&&s[t].isMine&&(r+=1),s[t+1]&&s[t+1].isMine&&(r+=1))}return r}getAdjacentCells(e,t){const r=[];for(let n=-1;n<2;n++){const s=this.board[e+n];if(s){let e=s[t-1],i=s[t],l=s[t+1];e&&!e.isMine&&r.push(e),0!==n&&i&&!i.isMine&&r.push(i),l&&!l.isMine&&r.push(l)}}return r}recursivelyOpenCells(e,t){let r=[],n=[this.board[e][t]];for(;n.length;){const e=n.shift(),t=this.getAdjacentCells(e.x,e.y);for(let s of t)s.isRevealed||(r.push(s),0===s.value&&n.push(s),s.isRevealed=!0)}return r}openCell(e,t){const{isMine:r,value:n,x:s,y:i}=this.board[e][t];if(r){return{gameOver:!0,revealed:[...this.board.flat(2).filter((e=>e.isMine))]}}return 0!==n?(this.board[e][t].isRevealed=!0,{gameOver:!1,revealed:[{value:n,x:s,y:i}]}):{gameOver:!1,revealed:[{value:n,x:s,y:i},...this.recursivelyOpenCells(e,t)]}}}const t={easy:{rows:10,columns:10,mines:15},medium:{rows:15,columns:15,mines:40},hard:{rows:20,columns:20,mines:99}};window.onload=function(){const r=document.querySelector("#difficulty"),n=document.querySelector("#board"),s=document.querySelector(".game-over"),i=document.querySelector("#timer"),l=s.querySelector("h1"),a=document.querySelector(".finish-time");let o=null,c=null;const d=()=>{const{rows:s,columns:d,mines:u}=t[r.value];c=new e(s,d,u),c.init(),l.style.display="block",i.innerHTML="<strong>‚è∞ Time </strong> 00:00",a.innerHTML="‚è∞ 00:00",((e,t)=>{n.innerHTML=e.reduce(((e,t)=>e+`<div class="cell" data-x="${t.x}" data-y="${t.y}"></div>`),""),n.style.width=`calc(${t*document.querySelector(".cell").clientWidth}px + ${2*(t-1)}px)`,o=setInterval((()=>{const e=Math.floor((Date.now()-c.startTime)/1e3),t=Math.floor(e/60).toString().padStart(2,"0"),r=Math.floor(e%60).toString().padStart(2,"0");i.innerHTML=`<strong>‚è∞ Time</strong> ${t}:${r}`,a.innerHTML=`‚è∞ ${t}:${r}`}),1e3),c.printBoard()})(c.board.flat(),d)};n.addEventListener("click",(({target:e})=>{if(!e.classList.contains("cell"))return;const{x:t,y:r}=e.dataset,{revealed:i,gameOver:a}=c.openCell(parseInt(t,10),parseInt(r,10));if(a)return clearInterval(o),e.innerHTML="üí£",void i.forEach(((e,t)=>{const r=n.querySelector(`:nth-child(${e.x*c.COLUMNS+e.y+1})`);setTimeout((()=>{r.dataset.val="üí£",r.innerHTML="üí£",t===i.length-1&&(l.innerHTML="You Lost !!! üëé",s.querySelector("#retry").innerHTML="Retry",s.style.top=0)}),200*t)}));c.board.flat().reduce(((e,t)=>e+(t.isRevealed?1:0)),0)+c.mines===c.ROWS*c.COLUMNS&&(clearInterval(o),l.innerHTML="You Win !!! ‚úåÔ∏è",s.querySelector("#retry").innerHTML="New Game",s.style.top=0);for(let s of i){const e=n.querySelector(`:nth-child(${s.x*c.COLUMNS+s.y+1})`);e.dataset.val=s.value,e.innerHTML=s.value||""}})),n.addEventListener("contextmenu",(e=>{e.target.classList.contains("cell")&&(e.preventDefault(),"üö©"===e.target.dataset.val?(delete e.target.dataset.val,e.target.innerHTML=""):(e.target.dataset.val="üö©",e.target.innerHTML="üö©"))})),r.addEventListener("change",(()=>{clearInterval(o),l.innerHTML="Start Game",l.style.display="none",a.style.display="none",s.style.top="0"})),document.querySelector("#retry").addEventListener("click",(()=>{d(),s.style.top="100%",a.style.display="block"}))};
