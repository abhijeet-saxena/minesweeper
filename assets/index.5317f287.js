class e{constructor(e,t,s){this.ROWS=e,this.COLUMNS=t,this.board=[],this.mines=s,this.mineLocations=new Set,this.revealedCount=0}init(){for(;this.mineLocations.size!==this.mines;)this.mineLocations.add(Math.floor(Math.random()*this.ROWS*this.COLUMNS));for(let e=0;e<this.ROWS;e++){const t=[];for(let s=0;s<this.COLUMNS;s++)t.push({x:e,y:s,isMine:this.mineLocations.has(this.ROWS*e+s),isRevealed:!1,value:null});this.board.push(t)}for(let e=0;e<this.ROWS;e++)for(let t=0;t<this.COLUMNS;t++)this.board[e][t].isMine||(this.board[e][t].value=this.getValueAtCell(e,t))}printBoard(){for(let e=0;e<this.ROWS;e++){let t="";for(let s=0;s<this.COLUMNS;s++)t+=`  ${this.board[e][s].isMine?"X":this.board[e][s].value}  `;console.log(`${t}\n`)}}getValueAtCell(e,t){let s=0;for(let i=-1;i<2;i++){const n=this.board[e+i];n&&(n[t-1]&&n[t-1].isMine&&(s+=1),n[t]&&n[t].isMine&&(s+=1),n[t+1]&&n[t+1].isMine&&(s+=1))}return s}getAdjacentCells(e,t){const s=[];for(let i=-1;i<2;i++){const n=this.board[e+i];if(n){let e=n[t-1],l=n[t],r=n[t+1];e&&!e.isMine&&s.push(e),0!==i&&l&&!l.isMine&&s.push(l),r&&!r.isMine&&s.push(r)}}return s}recursivelyOpenCells(e,t){let s=[],i=[this.board[e][t]];for(;i.length;){const e=i.shift(),t=this.getAdjacentCells(e.x,e.y);for(let n of t)n.isRevealed||(s.push(n),0===n.value&&i.push(n),n.isRevealed=!0,this.revealedCount+=1)}return s}openCell(e,t){const{isMine:s,value:i,x:n,y:l}=this.board[e][t];if(s)return{gameOver:!0,revealed:[...this.mineLocations]};if(0!==i)return this.revealedCount+=1,{gameOver:!1,revealed:[{value:i,x:n,y:l}],count:this.revealedCount};return{gameOver:!1,revealed:[{value:i,x:n,y:l},...this.recursivelyOpenCells(e,t)],count:this.revealedCount}}}const t={easy:{rows:10,columns:10,mines:10},medium:{rows:15,columns:15,mines:40},hard:{rows:20,columns:20,mines:99}},s=document.querySelector("#difficulty"),i=document.querySelector("#board"),{rows:n,columns:l,mines:r}=t.easy;let o=new e(n,l,r);o.init();const a=(e,t)=>{let s="";for(let i of e)s+=`\n    <div class="cell" data-x="${i.x}" data-y="${i.y}">\n      ${i.isRevealed?i.isMine?"ðŸ’£":i.value||"":""}\n    </div>`;i.innerHTML=s,i.style.width=`calc(${t*document.querySelector(".cell").clientWidth}px + ${2*(t-1)}px)`,o.printBoard()};a(o.board.flat(),o.COLUMNS),i.addEventListener("click",(({target:e})=>{if(!e.classList.contains("cell"))return;let{x:t,y:s}=e.dataset;t=parseInt(t,10),s=parseInt(s,10);const{revealed:n,gameOver:l,count:r}=o.openCell(t,s);if(l)return e.dataset.val="ðŸ’£",e.innerHTML="ðŸ’£",void n.forEach(((e,t)=>{const s=i.querySelector(`:nth-child(${e+1})`);setTimeout((()=>{s.dataset.val="ðŸ’£",s.innerHTML="ðŸ’£",t>=n.length-1&&alert("Game Over")}),200*t)}));for(let a of n){const e=i.querySelector(`:nth-child(${a.x*o.ROWS+a.y+1})`);e.dataset.val=a.value,e.innerHTML=a.value||""}})),s.addEventListener("change",(({target:{value:s}})=>{const{rows:i,columns:n,mines:l}=t[s];o=new e(i,n,l),o.init(),a(o.board.flat(),n)}));
