class e{constructor(e,t,n){this.startTime=Date.now(),this.ROWS=e,this.COLUMNS=t,this.board=[],this.mines=n,this.mineLocations=new Set}init(){for(;this.mineLocations.size!==this.mines;)this.mineLocations.add(Math.floor(Math.random()*this.ROWS*this.COLUMNS));for(let e=0;e<this.ROWS;e++){const t=[];for(let n=0;n<this.COLUMNS;n++)t.push({x:e,y:n,isMine:this.mineLocations.has(this.ROWS*e+n),isRevealed:!1,value:null});this.board.push(t)}for(let e=0;e<this.ROWS;e++)for(let t=0;t<this.COLUMNS;t++)this.board[e][t].isMine||(this.board[e][t].value=this.getValueAtCell(e,t))}printBoard(){for(let e=0;e<this.ROWS;e++){let t="";for(let n=0;n<this.COLUMNS;n++)t+=` ${this.board[e][n].isMine?"‚óâ":this.board[e][n].value} `;console.log(`${t}\n`)}console.log("\n")}getValueAtCell(e,t){let n=0;for(let r=-1;r<2;r++){const s=this.board[e+r];s&&(s[t-1]&&s[t-1].isMine&&(n+=1),s[t]&&s[t].isMine&&(n+=1),s[t+1]&&s[t+1].isMine&&(n+=1))}return n}getAdjacentCells(e,t){const n=[];for(let r=-1;r<2;r++){const s=this.board[e+r];if(s){let e=s[t-1],i=s[t],l=s[t+1];e&&!e.isMine&&n.push(e),0!==r&&i&&!i.isMine&&n.push(i),l&&!l.isMine&&n.push(l)}}return n}recursivelyOpenCells(e,t){let n=[],r=[this.board[e][t]];for(;r.length;){const e=r.shift(),t=this.getAdjacentCells(e.x,e.y);for(let s of t)s.isRevealed||(n.push(s),0===s.value&&r.push(s),s.isRevealed=!0)}return n}openCell(e,t){const{isMine:n,value:r,x:s,y:i}=this.board[e][t];if(n){return{gameOver:!0,revealed:[...this.board.flat(2).filter((e=>e.isMine))]}}return 0!==r?(this.board[e][t].isRevealed=!0,{gameOver:!1,revealed:[{value:r,x:s,y:i}]}):{gameOver:!1,revealed:[{value:r,x:s,y:i},...this.recursivelyOpenCells(e,t)]}}}const t={easy:{rows:10,columns:10,mines:15},medium:{rows:15,columns:15,mines:40},hard:{rows:20,columns:20,mines:99}};window.onload=function(){const n=document.querySelector("#difficulty"),r=document.querySelector("#board"),s=document.querySelector(".game-over"),i=document.querySelector("#timer"),l=s.querySelector("h1"),a=document.querySelector(".finish-time");let o=null,c=null,d=!1;const u=()=>{const{rows:s,columns:u,mines:h}=t[n.value];o=new e(s,u,h),o.init(),l.style.display="block",i.innerHTML="<strong>‚è∞ Time </strong> 00:00",a.innerHTML="‚è∞ 00:00",((e,t)=>{r.innerHTML=e.reduce(((e,t)=>e+`<div class="cell" data-x="${t.x}" data-y="${t.y}"></div>`),""),r.style.width=`calc(${t*document.querySelector(".cell").clientWidth}px + ${2*(t-1)}px)`,c=setInterval((()=>{const e=Math.floor((Date.now()-o.startTime)/1e3),t=Math.floor(e/60).toString().padStart(2,"0"),n=Math.floor(e%60).toString().padStart(2,"0");i.innerHTML=`<strong>‚è∞ Time</strong> ${t}:${n}`,a.innerHTML=`‚è∞ ${t}:${n}`}),1e3),o.printBoard()})(o.board.flat(),u),d=!1};r.addEventListener("click",(({target:e})=>{if(!e.classList.contains("cell")||d)return;const{x:t,y:n}=e.dataset,{revealed:i,gameOver:a}=o.openCell(parseInt(t,10),parseInt(n,10));if(a)return d=!0,clearInterval(c),e.innerHTML="üí£",e.dataset.val="üí£",void i.forEach(((e,t)=>{const n=r.querySelector(`:nth-child(${e.x*o.COLUMNS+e.y+1})`);setTimeout((()=>{n.dataset.val="üí£",n.innerHTML="üí£",t===i.length-1&&(l.innerHTML="You Lost !!! üëé",s.querySelector("#retry").innerHTML="Retry",s.style.top=0)}),200*t)}));o.board.flat().reduce(((e,t)=>e+(t.isRevealed?1:0)),0)+o.mines===o.ROWS*o.COLUMNS&&(clearInterval(c),l.innerHTML="You Win !!! ‚úåÔ∏è",s.querySelector("#retry").innerHTML="New Game",s.style.top=0);for(let s of i){const e=r.querySelector(`:nth-child(${s.x*o.COLUMNS+s.y+1})`);e.dataset.val=s.value,e.innerHTML=s.value||""}})),r.addEventListener("contextmenu",(e=>{e.target.classList.contains("cell")&&(e.preventDefault(),"üö©"===e.target.dataset.val?(delete e.target.dataset.val,e.target.innerHTML=""):(e.target.dataset.val="üö©",e.target.innerHTML="üö©"))})),n.addEventListener("change",(()=>{clearInterval(c),l.innerHTML="Start Game",l.style.display="none",a.style.display="none",s.style.top="0"})),document.querySelector("#retry").addEventListener("click",(()=>{u(),s.style.top="100%",a.style.display="block"}))};
